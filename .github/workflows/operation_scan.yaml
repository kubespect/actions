# Î™®ÎìàÏóê ÎåÄÌïú Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ ÌÉêÏÉâ
name: "Operation : Scan Changes"

on:
  workflow_call:        # workflow_call Ìò∏Ï∂ú
    inputs:
      MODULE:           # Î™®Îìà Ïù¥Î¶Ñ
        required: true
        type: string
      FIRST_COMMIT:     # Ï≤´Î≤àÏß∏ Ïª§Î∞ã SHA
        required: true
        type: string
      LAST_COMMIT:      # ÎßàÏßÄÎßâ Ïª§Î∞ã SHA
        required: true
        type: string
    outputs:
      CHANGES_TO_MODULE: # Î™®ÎìàÏóê ÎåÄÌïú Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Í∞úÏàò
        description: number of changes to the module
        value: ${{ jobs.scan.outputs.CHANGES_TO_MODULE }}

jobs:
  scan:
    runs-on: ubuntu-latest # Github Hosted Ubuntu RunnerÏóêÏÑú Ïã§Ìñâ
    outputs:
      CHANGES_TO_MODULE: ${{ steps.scan-changes.outputs.CHANGES_TO_MODULE }}  # Ï∂úÎ†•Í∞íÏúºÎ°ú CHANGES_TO_MODULE ÏÑ§Ï†ï
    steps:
      # ÏΩîÎìú Ï≤¥ÌÅ¨ÏïÑÏõÉ
      - id: checkout-code
        name: Checkout Code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0 # Î™®Îì† Ïª§Î∞ãÏùÑ Í∞ÄÏ†∏Ïò¥

      # Î≥ÄÍ≤ΩÏÇ¨Ìï≠ ÌÉêÏÉâ
      - id: scan-changes
        name: Scan Changes
        run: |
          echo "üîç CHECKING CHANGES BETWEEN ${{ inputs.FIRST_COMMIT }} AND ${{ inputs.LAST_COMMIT }} FOR MODULE ${{ inputs.MODULE }}"
          CHANGES_TO_MODULE=$(git diff --name-only ${{ inputs.FIRST_COMMIT }} ${{ inputs.LAST_COMMIT }} ${{ inputs.MODULE }} | awk 'END{print NR}')
          echo "CHANGES_TO_MODULE=$CHANGES_TO_MODULE" >> $GITHUB_OUTPUT
          echo "üîç CHANGES CHECKED"
          echo $CHANGES_TO_MODULE CHANGES DETECTED FOR MODULE ${{ inputs.MODULE }}
        
      